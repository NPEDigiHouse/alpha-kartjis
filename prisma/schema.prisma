generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Event {
  id                   String     @id
  name                 String     @db.VarChar(255)
  description          String?    @db.Text
  location             String     @db.VarChar(255)
  thumbnailURI         String?    @db.VarChar(255)
  schedules            Json
  createdAt            DateTime   @default(now())
  updatedAt            DateTime   @updatedAt
  paymentBankName      String?    @db.VarChar(100)
  paymentAccountNumber String?    @db.VarChar(50)
  paymentAccountName   String?    @db.VarChar(255)
  commiteeName         String?    @db.VarChar(255)
  commiteeEmail        String?    @db.VarChar(255)
  commiteeEOName       String?    @db.VarChar(255)
  commiteePhoneNumber  String?    @db.VarChar(15)
  orders               Order[]
  tickets              Ticket[]
  categories           Category[] @relation("CategoryToEvent")

  @@map("events")
}

model Category {
  id        String   @id
  name      String   @db.VarChar(100)
  eventId   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  events    Event[]  @relation("CategoryToEvent")

  @@map("categories")
}

model Ticket {
  id        String        @id
  name      String
  price     Int           @db.UnsignedInt
  eventId   String?
  stock     Int           @default(0) @db.UnsignedInt
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  adminFee  Int?          @db.UnsignedInt
  orders    OrderDetail[]
  Event     Event?        @relation(fields: [eventId], references: [id])

  @@index([eventId], map: "tickets_eventId_fkey")
  @@map("tickets")
}

model Customer {
  id          String   @id
  name        String?  @db.VarChar(255)
  email       String   @db.VarChar(255)
  birthDate   Int?
  phoneNumber String?
  gender      Gender
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orders      Order[]

  @@map("customers")
}

model OrderDetail {
  id                 String              @id
  ticketId           String?
  quantity           Int                 @default(1)
  orderId            String?
  name               String?             @db.VarChar(255)
  email              String              @db.VarChar(255)
  birthDate          Int?
  phoneNumber        String?
  gender             Gender
  address            String?             @db.VarChar(255)
  socialMedia        String?             @db.VarChar(255)
  location           String?             @db.VarChar(255)
  commiteeName       String?             @db.VarChar(255)
  TicketVerification TicketVerification?
  Order              Order?              @relation(fields: [orderId], references: [id], onDelete: Cascade)
  Ticket             Ticket?             @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([orderId], map: "orderDetails_orderId_fkey")
  @@index([ticketId], map: "orderDetails_ticketId_fkey")
  @@map("orderDetails")
}

model Order {
  id           String        @id
  status       PaymentStatus @default(INPROCESS)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  customerId   String?
  billId       Int?          @unique @db.UnsignedInt
  paymentId    String?       @db.VarChar(255)
  eventId      String?
  billLink     String?       @db.VarChar(255)
  billToken    String?       @db.VarChar(255)
  paymentType  String?       @db.VarChar(100)
  orderDetails OrderDetail[]
  Customer     Customer?     @relation(fields: [customerId], references: [id], onDelete: Cascade)
  Event        Event?        @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([customerId], map: "orders_customerId_fkey")
  @@index([eventId], map: "orders_eventId_fkey")
  @@map("orders")
}

model TicketVerification {
  id            String      @id
  hash          String      @unique
  isScanned     Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  orderDetailId String      @unique
  OrderDetail   OrderDetail @relation(fields: [orderDetailId], references: [id], onDelete: Cascade)
}

enum Gender {
  MALE
  FEMALE
}

enum PaymentStatus {
  SUCCESS
  INPROCESS
  FAILED
}
